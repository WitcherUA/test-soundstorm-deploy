name: Auto Deploy test-soundstorm

on:
  workflow_dispatch:
    inputs:
      version:
        description: '–í–µ—Ä—Å—ñ—è Docker-–æ–±—Ä–∞–∑—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, v13)'
        required: true
        default: 'v13'

  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: self-hosted

    env:
      DEPLOY_VERSION: ${{ github.event.inputs.version || 'v13' }}

    steps:
      - name: Checkout —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é
        uses: actions/checkout@v3

      - name: –í–∏–≤—ñ–¥ –≤–µ—Ä—Å—ñ—ó –¥–µ–ø–ª–æ—é
        run: echo "üìå –î–µ–ø–ª–æ–π –≤–µ—Ä—Å—ñ—ó: $DEPLOY_VERSION"

      - name: –ó–∞–ø—É—Å–∫ auto-push.sh –∑ –≤–µ—Ä—Å—ñ—î—é
        run: |
          chmod +x ./auto-push.sh
          ./auto-push.sh "$DEPLOY_VERSION"
